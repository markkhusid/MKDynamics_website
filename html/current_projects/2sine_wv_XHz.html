<!DOCTYPE html>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58919029-1', 'auto');
  ga('send', 'pageview');

</script>

<html>

<head>
  <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">

  <title>
    MK Dynamics
  </title>
  
  <link href="../css/styles.css" type = "text/css" rel = "stylesheet" />
  
  
    
    <style>
        p {
            font-family: Arial;
            color: black;
        }
    </style>
  
</head>

<body>

  <h1> 
    <big> <big> MK Dynamics </big> </big>
  </h1>

  <h2>
    Current Projects - Discretized Fourier Transform of Sine Waves at 50Hz and 100Hz using FFTW3
  </h2>
  
  <div id="nav">
    <ul>
      <li> <a href="../index.php">Home</a> </li>
      <li> <a href="../current_projects/current_projects_FFTW3.html">Back</a></li>
    </ul>
  </div>
  
  <hr />
  
  <p>
    <img src="../images/spacey.jpg" alt ="Space" class = "align-center medium" />
  
  <div id="content">
    <h3>
      Formation of a 50Hz + 100Hz Sine Waves using Python+Numpy on Jupyter Notebook
    </h3>
    
    <h4>
      Discussion:
      <hr />
    </h4>
    <p>
        We use Python together Numpy arrays and Matplotlib within a Jupyter Notebook to create a combined wave composed of two sine waves at 50Hz and 100Hz for 2 periods.  We then plot the time domain graph of the combined wave, and then compute the Discretized Fast Fourier Transform using the Python libraries.  The time domain data is then outputted to a file and used as an input for the DFFT Fortran program to computed the DFFT and plot its output with GNUPlot.
      <hr /><br>
    </p>
    
    <p> <b> Introduction: </b><br>
      First, we start with a Python script written in Jupyter Notebook to generate a wave composed of the combination of a 50Hz and a 100Hz sine wave, sampled at 10000Hz, for 2 periods, and save these raw data points to a file.  The Jupyter Notebook is shown below.  
    </p>
    
    <p> <b> Python+Numpy+Matplotlib on Jupyter Notebook code to generate a combined wave of two sine waves at<br> 50Hz and 100Hz sampled at 10kHz.</b> <br>
      <iframe
	src = "code_FFTW3/2sineXHz_jupyter_python.html"
	width = "850"
	height = "3200"
	frameborder = "1"
	scrolling = "yes">
      </iframe> <br>
      Download the code by clicking the link below:<br>
      <a href="code_FFTW3/2sineXHz.ipynb" target="_top">Python Script in Jupyter Notebook</a><br><br>
    </p>
    
    <p>
      We then run the code and obtain a time domain plot and a frequency domain plot.  The results are plotted with GNUPlot:<br>
    </p>
    
    <p><b> Image of 50Hz Sine Wave Generated Using Python+Numpy on Jupyter Notebook and Plotted with GNUPlot</b><br>
        <img 
            src="images/FFTW3/2sine_wv_XHz.png" 
            width="600" 
            height="450" 
            title="50Hz Sine Wave"
        />
        <br>
        Download the image by clicking the link below:<br>
        <a href="images/FFTW3/2sine_wv_XHz.png" target="_top">Image of combination wave</a><br><br><br>
    
        <img 
            src="images/FFTW3/2sine_wv_XHz_freq_domain.png" 
            width="600" 
            height="450" 
            title="50Hz Sine Wave"
        />
        <br>
        Download the image by clicking the link below:<br>
        <a href="images/FFTW3/2sine_wv_XHz_freq_domain.png" target="_top">Image of FFT of combination wave</a><br>
    
    </p>


    
    <!--
    <p><b> Image of the DFFT of a 50Hz Sine Wave, sampled at 1000Hz, using SciLAB</b><br>
      <img src="images/sine_wave2_10Hz_FFT.jpg" width="600" height="450" title="SciLAB FFT of 10Hz Sine Wave"/><br>
      Download the image by clicking the link below:<br>
      <a href="images/sine_wave2_10Hz_FFT.jpg" target="_top">Image of FFT of 10Hz sine wave generated in SciLAB</a>
    </p>
    
    <p> <b> Saving of time-domain data into a file </b> <br>
      The raw time-domain data is saved into a text file. <br>
      A portion of the data is shown below: <br>
      <iframe
	src = "code_FFTW3/sine_wave2_10Hz.csv.txt"
	width = "550"
	height = "100"
	frameborder = "1"
	scrolling = "no">
      </iframe><br>
      The data may be downloaded by clicking the link below: <br>
      <a href="code_FFTW3/sine_wave3_10Hz.csv" target="_top">CSV file containing discretized sine wave data</a><br><br>
    </p>
    
    <p> <b> Processing of CSV file into format suitable for input into Fortran 2003 DFFT code. </b> <br>
      Since the output of SciLAB is a comma separated value (CSV) file, a method is needed that will process<br>
      that file into another file, where the commas are removed and each data element is on a separate line.<br>
      Additionally, a the data elements need to be reformatted into fixed floating point, since the "e" <br>
      floating point format was noticed to possibly cause errors when input into the FFTW3 algorithm. <br>
      These operations were done using a Python script, with its powerful object-oriented file techniques and<br>
      its included CSV library.  The Python script is shown below: <br>
    </p>
    
    <p> <b> Python script to process CSV file by stripping commas and producing one data element per line </b><br>
      <iframe
	src = "code_FFTW3/convert_csv.txt"
	width = "550"
	height = "300"
	frameborder = "1"
	scrolling = "yes">
      </iframe><br>
      <a href="code_FFTW3/convert_csv.txt" target="_top">Python script that removes commas and produced one data element per line</a><br>
      Run by typing: <b>./convert_csv.py infile.csv outfile.dat</b> <br>
      where infile.csv is the data file in CSV format, and outfile.dat is the processed file <br>
      Obtain the line count of the processed file by typing: <b>wc -l outfile.dat</b><br>
      
      A portion of the processed CSV file is shown below: <br>
      <iframe
	src = "code_FFTW3/processed_sn_wv3_10Hz.dat"
	width = "550"
	height = "200"
	frameborder = "1"
	scrolling = "no">
      </iframe><br>
    
      The processed data may be downloaded by clicking the link below: <br>
      <a href="code_FFTW3/processed_sn_wv3_10Hz.dat" target="_top">Output of Python script</a><br>
    </p>
-->
    <p> <b> Obtaining Discretized Fast Fourier Transform of Raw Data File </b> <br>
      Now that the Python+Numpy on Jupyter Notebook script has output time domain data elements into a file, these<br>
      data elements can now be fed into the FFTW3 DFFT algorithm.  The algorithm is used within a Fortran 2003 program.<br>
      <a href="current_projects_FFTW3.html#Fortran 2003 Code">Click this link to see the Fortran 2003 DFFT code.</a><br>
    </p>
    
    <p> <b> Running the Fortran 2003 DFFT Program and Obtaining Output Files </b> <br>
      <a href="current_projects_FFTW3.html#Fortran 2003 Code">The Fortran 2003 code</a> is compiled and run with the raw data text file as input.  The resulting files <br>
      include the DFFT magnitude and phase. <br>
    </p>
    
    <p>
      Compile by typing: <b>gfortran -o a.out data_file_FFTW_ver6.F03 -lfftw3</b> <br>
      Run by typing: <b>./a.out outfile.dat DFFT_mag_file.dat DFFT_phase_file.dat sample_rate num_periods</b> <br>
      where outfile.dat is the output of the Python script, DFFT_mag_file.dat is the DFFT magnitude file,<br>
      DFFT_phase_file.dat is the DFFT phase file,sample_rate is the rate of sampling of the input data file, and num_periods<br>
      is the number of periods of data in the input data file.<br>
      The line count can be obtained by typing: <b>wc -l outfile.dat</b> 
    </p>
    
    <p> <b> The Output Files From the Fortran 2003 DFFT Program </b> <br>
      After the Fortran 2003 DFFT program has been run correctly, magnitude and phase files should <br>
      appear.  
      The program output is verbose (for debug) purposes and the screen output is shown below: <br>
      <iframe
	src = "code_FFTW3/fft_of_dat_output_2sine_wv.txt"
	width = "550"
	height = "200"
	frameborder = "1"
	scrolling = "yes">
      </iframe><br>
      The full text may be downloaded <a href="code_FFTW3/fft_of_dat_output_2sine_wv.txt">here.</a><br>
    </p>
    
    <p>
      <!--A section of the magnitude output file is shown below: <br>
      --<iframe
	src = "code_FFTW3/DFFT_mag_sn_wv_10Hz.dat"
	width = "550"
	height = "200"
	frameborder = "1"
	scrolling = "yes">
      </iframe><br>
    </p>
    
    <p>
      The phase file is shown below for completeness: <br>
      <iframe
	src = "code_FFTW3/DFFT_phase_sn_wv_10Hz.dat"
	width = "550"
	height = "200"
	frameborder = "1"
	scrolling = "yes">
      </iframe><br>
    </p>-->
    
    <!--<p> <b>Output files from running Fortran 2003 code</b><br>
      The data files may be downloaded by clicking the links below: <br>
      <a href="code_FFTW3/DFFT_mag_sn_wv_10Hz.dat" target="_top">Output of DFFT Fortran program as magnitude</a><br>
      <a href="code_FFTW3/DFFT_phase_sn_wv_10Hz.dat" target="_top">Output of DFFT Fortran progream as phase</a><br>
    </p>-->
    
    <p> <b>Plots of the magnitude output file using GNUPlot</b><br>
      The magnitude output file is plotted with GNUPlot.  A GNUPlot script file was created <br>
      to facilitate quality plotting. <br>
      <b>GNUPlot script file</b><br>
      <iframe
	src = "code_FFTW3/2sine_wv_gnuplot_macro.txt"
	width = "550"
	height = "120"
	frameborder = "1"
	scrolling = "no">
      </iframe><br>
      The GNUPlot script file may be downloaded by clicking <a href="code_FFTW3/sine_wv_50Hz_gnuplot_macro.txt">here.</a><br>
      Run by typing <b>gnuplot 2sine_wv_gnuplot_macro.txt</b> or start GNUPlot and enter<br>
      <b>load "2sine_wv_gnuplot_macro.txt"</b> at the gnuplot command prompt <br>
      
      <br><b> Magnitude Plot </b><br>
      <img src="images/FFTW3/DFFT_2sine_wv_XHz.png" width="600" height="450" title="Magnitude plot of DFFT of combination wave"/><br>
      
      <!--<br><b> Phase Plot </b><br>
      <img src="images/DFFT_phase_sine_wave2_10Hz.jpeg" width="600" height="450" title="Phase plot of DFFT of 10Hz sine wave"/><br>
      The phase plot above displays overall quantization noise and computation noise of FFTW3, since <br>
      pure frequency sine wave with zero phase should have been a straight line at 0 degrees. <br>  
      This plot gives a feel for the accuracy of the computational engine. <br>
    </p>-->
    
    <h4>
      Discussion:
      <hr />
    </h4>
    <p>
      There appears to be a slight decrease in the peak of the magnitude of the DFFT plot.  Since other raw data inputs into the Fortran program produced results as expected, the skew may be related to the way the data were generated in Python+Numpy or the way it was saved into a text file.  There also appears to be some secondary peaks that rapidly roll off on both sides of the main peak.  This is most likely due to the FFTW3 algorithm responding to the discontinuities of the input data. More research is needed to find the causes.
      <hr />      
    </p>
   
   <a href="current_projects_FFTW3.html#DFFT Program Performance">Back to Current Projects - FFTW3</a>
    
</body>
</html>
    
