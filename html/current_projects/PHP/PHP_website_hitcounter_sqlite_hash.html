<!DOCTYPE html>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58919029-1', 'auto');
  ga('send', 'pageview');

</script>

<html>

<head>
  <meta content="text/html; charset=utf-8" http-equiv="content-type">
  <meta name="robots" content="follow" />
  
  <title>
    MK Dynamics - PHP Programming - SQLite Based Unique Website Hitcounter with SHA256 Hashed Client IP Addresses
  </title>
  
  <link href="../../css/styles.css" type = "text/css" rel = "stylesheet" />
  
  <style>
    .content {
	overflow: auto;
	height: 80%; 
	background: url("../../images/saturn.jpg") no-repeat center center fixed;
	background-size: cover;
	background-position: center;
	padding: 10px;
	margin: 10px;
	border: 5px solid black;
      }
      
    h1, h2, h3, h4 {
      color: white;
      display: block;     
    }
    
    .current_project_1 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1200px;
      height		: 200px;
      top		: 0px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding-left	: 10px;
    }
    
    .current_project_110 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1200px;
      height		: 600px;
      top		: 0px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding-left	: 10px;
    }
    
    .current_project_120 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1200px;
      height		: 1700px;
      top		: 0px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding-left	: 10px;
    }
    
    .current_project_190 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 900px;
      height		: 700px;
      top		: 0px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding-left	: 10px;
    }
    
    .current_project_2 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 900px;
      height		: 700px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding-left	: 10px;
    }
    
    .current_project_3 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 900px;
      height		: 700px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding-left	: 10px;
    }
    
    .current_project_4 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 900px;
      height		: 700px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_5 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 900px;
      height		: 700px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_6 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 900px;
      height		: 700px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_7 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 900px;
      height		: 700px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_8 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 900px;
      height		: 700px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_9 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 900px;
      height		: 700px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_10 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 900px;
      height		: 700px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_11 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 900px;
      height		: 700px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    div .img {
      margin		: 0px;
      padding		: 10px;
      height		: auto;
      width		: auto;
      float		: left;
    }
    
    div .img img {
      display		: inline;
      margin		: 0px;
      padding		: 0px;
    }
    
    div .desc {
      color		: white;
      width		: 600px;
      margin		: 5px;
      padding		: 10px;
    }
  </style>
</head>

<body>
    <div class="wrapper">
    
        <header>
    
            <hgroup>
                <h1> 
                    <big> <big> MK Dynamics </big> </big>
                </h1>


                <h2>
                    PHP Programming - SQLite Based Unique Website Hitcounter with SHA256 Hashed Client IP Addresses
                </h2>
            </hgroup>
    

            <nav>
                <ul>
                    <li> <a href="../../index.php">Home</a> </li>
                    <li> <a href=".html">Online Resources</a> </li>
                    <li> <a href="PHP_Programming.html">Back</a> </li>
                </ul>
            </nav>
      
        </header>
    
        <section class="content">
            
            <!-- ************************************************************************************** First Section Start ************ -->
            <section class="section">

                <div class="current_project_1">
                    
                    <hgroup>
                        <h3>
                            Introduction
                        </h3>
                    </hgroup>
                    

                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            In this section we will write PHP programs for webserver-side scripting.  An item that was frequently found on websites in the early days of the internet was a website hit counter.  We will write such a website hit counter in PHP.
                        </p>
                        
                        <p>
                            Additionally, we will show how to control an Arduino from a webpage using PHP.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->

                </div> <!-- .current_project_1 -->
        
            </section> <!-- first_section -->
            <!-- ************************************************************************************** First Section End ************ -->
            
            <!-- ************************************************************************************** Second Section Start ********* -->
            <section class="section">
                
                <div class="current_project_110">
                
                    <hgroup>
                        <h3>
                            Website Hit Counter
                        </h3>
                        <h4>
                            PHP Based Unique Website Hit Counter Using SQLite Database and SHA256 Hash of Client IP Address to Prevent Tracking
                        </h4>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        <p>
                            As stated in the Introduction, an item that was frequently found on websites in the early days of the internet was a website hit counter.  We will write such a website hit counter in PHP.  To figure out that the visiting client is unique, we will setup and query an SQLite database to look for the client's IP address.  Since we are against direct tracking of client IP addresses in general, we will take a SHA256 hash of the client's IP and web browser configuration (both items of information that are freely available to any webserver that receives in incoming requests), and store that hash into the database.  This hash is a unique identifier of the visiting client.  A view of the entries of the database will data as demonstrated below:
                            <blockquote>
                                sqlite> select * from hits;
                                48cb7c8c802db95c4036e812bfd07bb8********************************
                                a600d9c8589ccf8112b4e4bf0391a48b********************************
                                c536c6ccd52a72994d618094a7e158fb********************************
                                e434ec645fe01ffe73d1fbedcec940f8********************************
                                e68816f6864e1c387de52ce932181c9b********************************
                                db2612ea330d6e50dbc4e93dc3b584e0********************************<br>
                                sqlite> 
                            </blockquote>
                        </p>
                        
                        <p>
                            As can be seen from the SQLite database query above, each row represents a SHA265 hash string.  The string is 64 characters long, and I have replaced the final 32 characters with asterisks '*' for privacy reason.  The real entries in the database will contain 64 characters whose final 32 characters look similar to the initial 32 characters.  Each hash string has encoded into it the client's IP address.  It is very difficult, but not impossible, to recover the client's actual IP address.  This would require knowing the exact configuration of the client's web browser and computer, and brute forcing it together with the guessed IP address to receive the same hash string.  Needless to say, this is an endeavor that is of no interest to the website owner, and therefore, the objective of not recording the client's IP address is achieved.
                        </p>
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                
                </div> <!-- .current_project_190 -->
            
            </section> <!-- second_section -->
            <!-- **************************************************************************************** Second Section End ************ -->
            
            <!-- **************************************************************************************** Third Section Start ********* -->
            <section class="section">
                
                <div class="current_project_120">
                
                    <hgroup>
                        <h3>
                            PHP Code for Website Hitcounter That Stores SHA256 Hash of Client IP in SQLite Database
                        </h3>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            In this section we present the PHP code for the unique website hitcounter.  The code makes use of an SQLite database to store hashed client IP's to figure out if the client is unique or not.  It was important to store a SHA256 hash of the client IP in order to make tracking of the raw client IP address extremely difficult.  This is done for the privacy of the client, which this website author respects.  Note that like all webservers with standard configurations, client IP addresses are stored in the webserver logs.  Use TOR or a VPN to hide your real IP address.
                        </p>
                        
                        <p>
                            We present the code and describe it below.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <iframe
                        src="code_webhit_counter/counter.php.html" 
                        height="600" 
                        width="1100">
                    </iframe>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            We first define the directory to store the SQLite database.  The database name is the hostname of the webserver + _log.sq3.  We obtain the client's IP address and store it into a variable $client_ip.  We also obtain the client's user agent configuration.  An example would be something like this: Mozilla/5.0 (X11; U; Linux; i686; en-US; rv:1.6) Gecko Debian/1.6-7.  These two items of user data are then hashed together using SHA256 to produce a unique 64 character user identifier.  An example would be: 48cb7c8c802db95c4036e812bfd07bb8********************************.  Note that I have replaced the last 32 characters with asterisks.  This hashed unique user identifier is stored into the SQLite database.  Note that we do NOT store the raw client IP.
                        </p>
                        
                        <p>
                            We then check if the database exists.  If it does not, we create the database and a table within it called "hits".  Hits has one column called hash_client_ip of type VARCHAR(255).  If the database already exists then just create and assign a PHP Data Object (PDO) to the variable $logdb.  Note that I have plenty of diagnostic echo statements throughout the code.  Feel free to comment them out in your application.
                        </p>
                        
                        <p>
                            We then query the database for the hashed client's IP.  This is a two step process, since the query returns an array.  We are interested in the first element of the array, which contains data if the hashed client IP is found.  We then open two text files that exist on the server.  These two files are total_hit_counter.txt and unique_hit_counter.txt.  They store the number of times the website was hit in plain text format.  I decided to keep the two files separate for simplicity.  The files are assigned to file pointers, $total_fp and $unique_fp.
                        </p>
                        
                        <p>
                            We then check if the query resulted in a non-zero result.  If it has, then the hashed client IP is already in the database.  We increment the first element of $total_hits array, but not the $unique_hits array.  We then perform a write to the $total_fp file pointer as well as the $unique_fp file pointer.  We need to write to both of them since both were opened for writing.  If we did not write to the $unique_fp file pointer, the contents of the file would be lost.
                        </p>
                        
                        <p>
                            We then handle the case of the hashed client IP not being in the database.  In this case we increment both counters and write out the incremented counters to both files.  The values of the counters are then displayed via HTML heading size 2 tags.  Finally, the files are closed and connection to the database is released.
                        </p>
                        
                        <p>
                            Prerequisites for using this PHP code.<br>
                            1) You must have the files total_hit_counter.txt and unique_hit_counter.txt in the same directory where counter.php is stored.<br>
                            2) You must have a directory called hitcounter_db underneath the directory where counter.php is stored.  No need to create the SQLite database, as the PHP code creates it for you if the database is missing.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
            
            </section> <!-- third_section -->
            <!-- ****************************************************************************************** Third Section End ************ -->

        </section>	<!-- .content -->
    
    <div> <!-- .wrapper -->

  </body>

</html>
