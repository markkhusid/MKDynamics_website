<!DOCTYPE html>

<html>

<head>
  <meta content="text/html; charset=utf-8" http-equiv="content-type">
  <meta name="robots" content="follow" />
  
  <title>
    MK Dynamics - Computer Security - SLAE64 - SecurityTube Linux Assembly Language and Shellcoding Expert 64-Bit
  </title>
  
  <link href="../../../css/styles.css" type = "text/css" rel = "stylesheet" />
  
  <style>
    .content {
	overflow: auto;
	height: 80%; 
	background: url("../../../images/saturn.jpg") no-repeat center center fixed;
	background-size: cover;
	background-position: center;
	padding: 10px;
	margin: 10px;
	border: 5px solid black;
      }
      
    h1, h2, h3, h4 {
      color: white;
      display: block;     
    }
    
    .current_project_1 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width			: 1350px;
      height		: 2000px;
      top			: 10px;
      left			: 10px;
      float			: center;
      margin		: 10px;
      padding-left	: 10px;
	  padding-top	: 10px;
    }
    
    .current_project_2 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width			: 1350px;
      height		: 1600px;
      top			: 0px;
      left			: 0px;
      float			: left;
      margin		: 10px;
      padding-left	: 10px;
    }
    
    .current_project_3 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width			: 1370px;
      height		: 1400px;
      top			: 0px;
      left			: 0px;
      float			: left;
      margin		: 10px;
      padding-left	: 10px;
    }
    
    .current_project_4 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width			: 1370px;
      height		: 1500px;
      top			: 0px;
      left			: 0px;
      float			: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_5 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width			: 1370px;
      height		: 1500px;
      top			: 0px;
      left			: 0px;
      float			: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_6 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width			: 1370px;
      height		: 2700px;
      top			: 0px;
      left			: 0px;
      float			: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_7 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width			: 1370px;
      height		: 4700px;
      top			: 0px;
      left			: 0px;
      float			: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_8 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width			: 1370px;
      height		: 1500px;
      top			: 0px;
      left			: 0px;
      float			: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_9 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width			: 1370px;
      height		: 1500px;
      top			: 0px;
      left			: 0px;
      float			: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_10 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width			: 1370px;
      height		: 1500px;
      top			: 0px;
      left			: 0px;
      float			: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_11 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width			: 1370px;
      height		: 1500px;
      top			: 0px;
      left			: 0px;
      float			: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    div .img {
      margin		: 0px;
      padding		: 10px;
      height		: auto;
      width			: auto;
      float			: left;
    }
    
    div .img img {
      display		: inline;
      margin		: 0px;
      padding		: 0px;
    }
    
    div .desc {
      color			: white;
      width			: 600px;
      margin		: 5px;
      padding		: 10px;
    }
  </style>
</head>

<body>
    <div class="wrapper">
    
        <header>
    
            <hgroup>
                <h1> 
                    <big> <big> MK Dynamics </big> </big>
                </h1>


                <h2>
                    Computer Security - SLAE64 - Module 1 - GDB Test
                </h2>
            </hgroup>
    

            <nav>
                <ul>
                    <li> <a href="../../../index.php">Home</a> </li>
                    <li> <a href="../computer_security_SLAE64.html">Back</a> </li>
                </ul>
            </nav>
    
        </header>
    
        <section class="content">
            
            <!-- ************************************************************************************** First Section Start ************ -->
            <section class="section">
        
                <div class="current_project_1">
                  
                    <iframe
                    	src = "HTML_sections/003_computer_security_SLAE64_Mod1_GDB_test.html"
						margin = "10px"
						width = "98%"
						height = "98%"
					>
					</iframe>
  
                </div> <!-- .current_project_1 -->
        
            </section> <!-- first_section -->
            <!-- *********************************************************************************** Section End ************** -->
            
            <!-- *********************************************************************************** Section Start ************ -->
            <section class="section">
                
                <div class="current_project_2">
                
                    <hgroup>
                        <h2>
                            The program <i>gdb_test.c</i>
                        </h2>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            The screenshot below displays the contents of the program <i>gdb_test.c</i>.  
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/003_GDB_Test/gdb_test.c.png"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                The test program <i>gdb_test.c</i>
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    
                    
                </div> <!-- .current_project_2 -->
            
            </section> <!-- section -->
            <!-- ************************************************************************************* Section End ************* -->
            
            
            <!-- *********************************************************************************** Section Start ************ -->
            <section class="section">
                
                <div class="current_project_3">
                
                    <hgroup>
                        <h2>
                            Running <i>gdbtest</i> in GDB + GEF
                        </h2>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            The screenshot below shows the executable <i>gdbtest</i> being run in GDB + GEF.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/003_GDB_Test/running_gdb_test_in_GEF.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Running the executable <i>gdbtest</i> in GDB + GEF
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                                        
                    <iframe
                    src = "HTML_sections/current_projects_3.html"
					width = "98%"
					height = "13%"
					>
					</iframe>
                    
                </div> <!-- .current_project_2 -->
            
            </section> <!-- section -->
            <!-- ************************************************************************************* Section End ************* -->
        
            <!-- ************************************************************************************* Section Start *********** -->
            <section class="section">
                
                <div class="current_project_4">
                
                    <hgroup>
                        <h2>
                            Running <i>gdbtest</i> in GDB + GEF
                        </h2>
                        
                        <h3>
                            Examining the Disassembly of Main in Detail
                        </h3>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            In this section, we will examine the disassembly of the function <i>main</i> in more detail.  We will use the ATT format to become accustomed to it, but generally, the Intel format seems to be more prevalent.  In the screenshot below, we show the disassembly of the function <i>main</i> in both formats.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/003_GDB_Test/disassembly_of_main.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Disassembly of the function <i>main</i> in both Intel and ATT formats.
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            In the next section, we will zoom in to the function <i>main</i> shown in ATT format for clarity.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                
                </div> <!-- .current_project_3 -->
                
            </section> <!-- third_section -->
            <!-- ************************************************************************************* Section End ************ -->
            
            <!-- ************************************************************************************* Section Start *********** -->
            <section class="section">
                
                <div class="current_project_5">
                    
                    <hgroup>
                
                        <h2>
                            Running <i>gdbtest</i> in GDB + GEF
                        </h2>
                        
                        <h3>
                            Examining the Disassembly of Main in ATT Format in Detail
                        </h3>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            In the screenshot below, we can see the disassembly of the function <i>main</i> in ATT format and zoomed in for better viewing.  When viewing the assembly instructions, one instruction stands out as particularly interesting.  It is the string compare instruction, at main+44.  If we could alter the return value of this function to satisfy the test that indeed a correct password was entered, then we can crack this password checking program.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/003_GDB_Test/disassembly_of_main_ATT_zoomed.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Disassembly of the function <i>main</i> in the ATT format and zoomed in.
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            In the next section, we will highlight the strcmp (string compare) instruction for clarity.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                
                </div> <!-- .current_project_4 -->
            
            </section> <!-- third_section -->
            <!-- ************************************************************************************* Section End ************ -->
            
            <!-- ************************************************************************************* Section Start *********** -->
            <section class="section">
                
                <div class="current_project_6">
                
                    <hgroup>
                
                        <h2>
                            Running <i>gdbtest</i> in GDB + GEF
                        </h2>
                        
                        <h3>
                            Highlighting the <i>strcmp</i> Instruction for Clarity 
                        </h3>
                        
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            In the screenshot below, we can see the disassembly of the function <i>main</i> and the strcmp (string compare) highlighted.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/003_GDB_Test/disassembly_of_main_strcpy_highlighted.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Disassembly of the function <i>main</i> and the strcmp (string compare) instruction highlighted.
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                     <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            In the screenshot above, we can see the disassembly of the function <i>main</i> and the strcmp (string compare) highlighted.
                        </p>
                        
                        <p>
                            We see a couple of <i>mov</i> instructions prior to the string compare, and a <i>test eax, eax</i> instruction following it.  The idea is that the <i>strcmp</i> function returns a zero into eax if the command line argument to the gdb_test executable matches the hardcoded password.  If the strings match, then the <i>test eax, eax</i> instruction performs a bitwise <i>AND</i> on the operands and sets the zero flag if the strings matched.  The result of the bitwise <i>AND</i> is not stored back into the register eax, only the zero flag is set.
                        </p>
                        
                        <p>
                            After the <i>test eax, eax</i> instruction, we see a <i>jne</i> or a Jump if Not Equal instruction, and then a series of <i>puts</i> function calls.  If the zero flag is not set, the program jumps to main+65, prints a string and then exits.  If they are equal, the <i>puts</i> function call at main+58 executes and then jumps to the end of the program.
                        </p>
                        
                        <p>
                            We can see a graphical visualization of this with the help of Radare2.  A screenshot this is shown below:
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/003_GDB_Test/radare2_disassembly_of_gdb_test.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Disassembly of the function <i>main</i> and visualization in Radare2
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                     <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            In the screenshot above, we can see the disassembly of the function <i>main</i> in Radare2.
                        </p>
                        
                        <p>
                            In Radare2, we can clearly see the flow graph of the branching after the test for zero in eax is performed.  If we could modify eax to be a zero after this test, no matter what the command line argument was, then we can effectively always force the program to print the string that we want.
                        </p>
                        
                        <p>
                            In the next section, we will setup a breakpoint just before the <i>test eax, eax</i>.  Before executing this instruction, we will mov a zero into eax, effectively negating the results of the string compare.  The program will then continue as if the correct password was entered, effectively being cracked.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                
                </div> <!-- .current_project_6 -->
            
            </section> <!-- third_section -->
            <!-- ************************************************************************************* Section End ************ -->
            
            <!-- ************************************************************************************* Section Start *********** -->
            <section class="section">
                
                <div class="current_project_7">
                
                    <hgroup>
                
                        <h2>
                            Running <i>gdbtest</i> in GDB + GEF
                        </h2>
                        
                        <h3>
                            Setting up break point at the instruction <i>test eax, eax</i>
                        </h3>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            In this section we will setup a breakpoint at just before the instruction <i>test eax, eax</i>.  But first we must run the program with an arbitrary argument.  We will use the string "AAAA" for its ease of recognition in either ASCII format or its hex equivalent, 0x64646464.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->

                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/003_GDB_Test/running_gdb_test_with_AAAA.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Running <i>gdb_test</i> with the argument AAAA
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            In the screenshot above, we can see that <i>gdb_test</i> was run with the argument AAAA.  This has been highlighted for clarity.  The program will then execute a number of instructions that set up the stack for the local variables.  We will not go into the details here in this section, because here will concentrate on using GDB to crack the program.  What is important to note is that the arguments to the vulnerable <i>strcmp</i> function are passed through the registers RDI and RSI.  We will now set a breakpoint just before <i>test eax, eax</i> and also highlight RDI and RSI for clarity.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/003_GDB_Test/set_breakpoint_before_test_eax_eax.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Breakpoint set at <i>test eax, eax</i>
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            In the screenshot above, we can see that a breakpoint was set at <i>*main+52</i>, which corresponds to the <i>test eax, eax</i> instruction.  We can also see that the two lines prior to the <i>strcmp</i> call were highlighted, to emphasize that the arguments to <i>strcmp</i> are passed via the registers RDI and RSI, per calling convention.
                        </p>
                        
                        <p>
                            We will now continue exectution until the breakpoint at <i>*main+52</i>.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/003_GDB_Test/before_test_eax_eax_showing_rdi_and_rsi.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Breakpoint hit at <i>test eax, eax</i>.  Also, RDI and RSI are highlighted for emphasis.
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            In the screenshot above, we can see that the breakpoint at <i>*main+52</i> was hit.  We can also see that the two lines prior to the <i>strcmp</i> call were highlighted, to emphasize that the arguments to <i>strcmp</i> are passed via the registers RDI and RSI, per calling convention.  The RDI contains the memory address of the passed command line argument "AAAA", while RSI contains the address of the hardcoded password "PentesterAcademyPass".
                        </p>
                        
                        <p>
                            The two strings pointed to RDI and RSI are obviously different.  The result of the <i>strcmp</i> call will place a non-zero result into RAX, as shown in the screenshot below.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/003_GDB_Test/result_of_strcmp_showing_rax.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                RAX highlighted to show result of the <i>strcmp</i> call.
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    
                    
                </div> <!-- .current_project_7 -->
            
            </section> <!-- third_section -->
            <!-- ************************************************************************************* Section End ************ -->
            
            <!-- ************************************************************************************* Section Start *********** -->
            <section class="section">
                
                <div class="current_project_8">
                
                    <hgroup>
                        <h2>
                            Lorem
                        </h2>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            Lorem
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/003_GDB_Test/before_strcpy_showing_rdi_and_rsi.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Lorem
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                
                </div> <!-- .current_project_7 -->
            
            </section> <!-- third_section -->
            <!-- ************************************************************************************* Section End ************ -->
            
            <!-- ************************************************************************************* Section Start *********** -->
            <section class="section">
                
                <div class="current_project_9">
                
                    <hgroup>
                        <h2>
                            Lorem
                        </h2>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            Lorem
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/003_GDB_Test/setting_rdi_equal_to_rsi.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Lorem
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                
                </div> <!-- .current_project_8 -->
            
            </section> <!-- third_section -->
            <!-- ************************************************************************************* Section End ************ -->
            
            <!-- ************************************************************************************* Section Start *********** -->
            <section class="section">
                
                <div class="current_project_10">
                
                    <hgroup>
                        <h2>
                            Lorem
                        </h2>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            Lorem
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/003_GDB_Test/result_of_setting_rdi_to_rsi.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Lorem
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                
                </div> <!-- .current_project_9 -->
            
            </section> <!-- third_section -->
            <!-- ************************************************************************************* Section End ************ -->
            
            <!-- ************************************************************************************* Section Start *********** -->
            <section class="section">
                
                <div class="current_project_11">
                
                    <hgroup>
                        <h2>
                            Lorem
                        </h2>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            Lorem
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/003_GDB_Test/successful_hack_of_gdbtest.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Lorem
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                
                </div> <!-- .current_project_10 -->
            
            </section> <!-- third_section -->
            <!-- ************************************************************************************* Section End ************ -->
            
        </section>	<!-- .content -->
    
    <div> <!-- .wrapper -->

  </body>

</html>
