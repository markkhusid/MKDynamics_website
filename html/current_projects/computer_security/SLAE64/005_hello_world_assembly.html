<!DOCTYPE html>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58919029-1', 'auto');
  ga('send', 'pageview');

</script>

<html>

<head>
  <meta content="text/html; charset=utf-8" http-equiv="content-type">
  <meta name="robots" content="follow" />
  
  <title>
    MK Dynamics - Computer Security - SLAE64 - SecurityTube Linux Assembly Language and Shellcoding Expert 64-Bit
  </title>
  
  <link href="../../../css/styles.css" type = "text/css" rel = "stylesheet" />
  
  <style>
    .content {
	overflow: auto;
	height: 80%; 
	background: url("../../../images/saturn.jpg") no-repeat center center fixed;
	background-size: cover;
	background-position: center;
	padding: 10px;
	margin: 10px;
	border: 5px solid black;
      }
      
    h1, h2, h3, h4 {
      color: white;
      display: block;     
    }
    
    .current_project_1 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1370px;
      height		: 200px;
      top		: 0px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding-left	: 10px;
    }
    
    .current_project_2 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1370px;
      height		: 3000px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding-left	: 10px;
    }
    
    .current_project_3 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1370px;
      height		: 1500px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding-left	: 10px;
    }
    
    .current_project_4 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1370px;
      height		: 3000px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_5 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1370px;
      height		: 2500px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_6 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1370px;
      height		: 2800px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_7 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1370px;
      height		: 4000px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_8 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1370px;
      height		: 2500px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_9 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1370px;
      height		: 3500px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_10 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1370px;
      height		: 2800px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_11 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1370px;
      height		: 4200px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_12 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1370px;
      height		: 1000px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    div .img {
      margin		: 0px;
      padding		: 10px;
      height		: auto;
      width		: auto;
      float		: left;
    }
    
    div .img img {
      display		: inline;
      margin		: 0px;
      padding		: 0px;
    }
    
    div .desc {
      color		: white;
      width		: 600px;
      margin		: 5px;
      padding		: 10px;
    }
  </style>
</head>

<body>
    <div class="wrapper">
    
        <header>
    
            <hgroup>
                <h1> 
                    <big> <big> MK Dynamics </big> </big>
                </h1>


                <h2>
                    Computer Security - SLAE64 - Module 1 Section 5 - Hello World
                </h2>
            </hgroup>
    

            <nav>
                <ul>
                    <li> <a href="../../../index.php">Home</a> </li>
                    <li> <a href="../computer_security_SLAE64.html">Back</a> </li>
                </ul>
            </nav>
    
        </header>
    
        <section class="content">
            
            <!-- ************************************************************************************** First Section Start ************ -->
            <section class="section">
        
                <div class="current_project_1">
                    
                    <hgroup>
                        <h2>
                            Introduction
                        </h2>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            In this section we will be following along with and completing course material from the Pentester Academy's SecurityTube Linux Assembly language Expert 64 Bit course.  The 
                            second assignment is writing a Hello World program in 64 Bit assembly language.  It is to be coded, assembled, linked and run.  Execution is then to be monitored via GDB.  We will use the GEF add-on for GDB to enhance the visual presentation from GDB.
                        </p>
                        <p>
                            Project code is contained in my <a href="https://github.com/markkhusid/SLAE64">github</a>.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->

                </div> <!-- .current_project_1 -->
        
            </section> <!-- first_section -->
            <!-- *********************************************************************************** Section End ************** -->
            
            <!-- *********************************************************************************** Section Start ************ -->
            <section class="section">
                
                <div class="current_project_2">
                
                    <hgroup>
                        <h2>
                            The program <i>helloworld.asm</i>
                        </h2>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            The screenshot below displays the contents of the program <i>helloworld.asm</i>.  The program contains a string called <i>hello_world</i> that holds the string Hello World to the SLAE-64 Course.  A new line is added by appending the 0x0a ASCII character.  We need to assemble, link, run and instruction step this program in GDB.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_asm_code.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                The program <i>helloworld.asm</i>
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            The program is assembled with:
                            <blockquote>
                                $ nasm -felf64 helloworld.asm -o helloworld.o
                            </blockquote>
                            
                            And linked with:
                            <blockquote>
                                $ ld helloworld.o -o helloworld
                            </blockquote>
                        </p>
                        
                        <p>
                            We then run the executable and look at it's objdump.  The results of these operations is shown below:
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_assembling_and_linking.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Assembling, Linking and Executing the Program <i>helloworld.asm</i>
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            In the above screenshot, we assemble and link the program.  We then use the objdump tool to look at the opcodes within the .text section by using the <i>-d</i> switch.  Finally the program is run using:
                            <blockquote>
                                $ ./helloworld
                            </blockquote>
                        </p>
                        
                        <p>
                            The "./" is needed because the executable is not in a directory listed in the PATH environment variable.
                        </p>
                        
                        <p>
                            In the objdump of the executable, we notice large amounts of null bytes (i.e. 00).  These are not good for shellcode, since in many cases, a victim process encountering a null byte as input understands the null byte as an end of the input.  This would prematurely end the victim program from receiving all of the shellcodes contents.
                        </p>
                        
                        <p>
                            In further videos in this course, the instructor shows how to remove these null bytes, while still maintaining the same functionality in the executable.
                        </p>
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                   
                </div> <!-- .current_project_2 -->
            
            </section> <!-- section -->
            <!-- ************************************************************************************* Section End ************* -->
            
            
            <!-- *********************************************************************************** Section Start ************ -->
            <section class="section">
                
                <div class="current_project_3">
                
                    <hgroup>
                        <h2>
                            Running <i>helloworld</i> in GDB + PEDA
                        </h2>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            Setup and before run
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_in_GDB_before_run.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                <i>helloworld</i> in GDB before run
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            From the disassembly of the _start function above, we can notice a difference between our written code and the disassembly of the _start function.  Namely, rather than involving the 64-bit versions of the registers, the assembler optimized away usage of those in favor of the 32-bit versions.  For example, the register RAX was replaced with EAX.
                        </p>
                        
                        <p>
                            From a functionality point of view, this is a moot point.  However, from a shellcoding perspective, it is desireable to have complete control over how the actual opcodes are produced.
                        </p>
                        
                        <p>
                            In the next sections, we will step through the code and describe what occurs.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                
                </div> <!-- .current_project_3 -->
            
            </section> <!-- section -->
            <!-- ************************************************************************************* Section End ************* -->
        
            <!-- ************************************************************************************* Section Start *********** -->
            <section class="section">
                
                <div class="current_project_4">
                
                    <hgroup>
                        <h2>
                            Running <i>helloworld</i> in GDB + PEDA
                        </h2>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            Running step <i><0x401000 <_start>:	mov    eax,0x1</i>
                        </p>
                        
                        <p>
                            Prior to running <i>mov eax, 0x1</i>, the state of the registers and stack is shown below:
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_in_GDB_before_running_step1.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Prior to executing the instruction <i>mov eax, 0x1</i>
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            The <i>mov eax, 0x1</i> instruction simply moves the immediate value 1 into the 32-bit register eax.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_in_GDB_after_running_step1.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                After executing the instruction <i>mov eax, 0x1</i>
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            The <i>mov eax, 0x1</i> instruction moved the immediate value 1 into the 64-bit register rax, as can be seen in the screen shot above.  The purpose of moving the immediate 1 into eax is to set up the write system call.  If you recall, the system calls are enumerated in:
                            <blockquote>
                                /usr/include/asm/unistd_64.h
                            </blockquote>
                        </p>
                        
                        <p>
                            A portion of this file is shown below:
                            <blockquote>
                                <pre>
    ┌─[mark@ubermentch]─[/usr/include/asm]
    └──╼ $more unistd_64.h 
    #ifndef _ASM_X86_UNISTD_64_H
    #define _ASM_X86_UNISTD_64_H 1

    #define __NR_read 0
    #define __NR_write 1
    #define __NR_open 2
    #define __NR_close 3
    #define __NR_stat 4
    #define __NR_fstat 5
    #define __NR_lstat 6
    #define __NR_poll 7
    #define __NR_lseek 8
    #define __NR_mmap 9
    #define __NR_mprotect 10
    #define __NR_munmap 11
    #define __NR_brk 12
    #define __NR_rt_sigaction 13
                                </pre>
                            </blockquote>
                        </p>
                        
                        <p>
                            As can be seen from the file contents above, the number 1 is associated with the WRITE system call.  Note that I have looked at the 64 bit version of the file.  There also exists a 32-bit version, which we will not be using since this is 64-bit code.
                        </p>
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                
                </div> <!-- .current_project_4 -->
            
            </section> <!-- section -->
            <!-- ************************************************************************************* Section End ************ -->
            
            <!-- ************************************************************************************* Section Start *********** -->
            <section class="section">
                
                <div class="current_project_5">
                
                    <hgroup>
                        <h2>
                            Running <i>helloworld</i> in GDB + PEDA
                        </h2>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            Executing step <i>0x401005 <_start+5>:	mov    edi,0x1</i>
                        </p>
                        
                        <p>
                            Prior to executing the instruction <i>mov    edi,0x1</i>, the state of the registers and stack are as shown below:
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_in_GDB_before_running_step2.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Prior to executing the instruction <i>mov    edi,0x1</i>
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            The instruction <i>mov    edi,0x1</i> simply moves the immediate value 1 into the 32-bit register <i>edi</i>.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_in_GDB_after_running_step2.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                After executing the instruction <i>mov    edi,0x1</i>
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            The <i>mov edi, 0x1</i> instruction simply moved the immediate value 1 into the 32-bit register edi, as can be seen in the screen shot above.  The purpose of moving the 1 into edi is as a parameter to the WRITE system call.  The 1 represents standard output, or STDOUT.  This refers to the screen.  Therefore, the WRITE system call will be writing to the screen, as opposed to writing to a network socket, or to a file on disk.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                
                </div> <!-- .current_project_5 -->
            
            </section> <!-- section -->
            <!-- ************************************************************************************* Section End ************ -->
            
            <!-- ************************************************************************************* Section Start *********** -->
            <section class="section">
                
                <div class="current_project_6">
                
                    <hgroup>
                        <h2>
                            Running <i>helloworld</i> in GDB + PEDA
                        </h2>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            Executing step <i>0x40100a <_start+10>:	movabs rsi,0x402000</i>
                        </p>
                        
                        <p>
                            Prior to executing the instruction <i>0x40100a <_start+10>:	movabs rsi,0x402000</i>, the state of the registers and stack are as shown below:
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_in_GDB_before_running_step3.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Prior to executing the instruction <i>0x40100a <_start+10>:	movabs rsi,0x402000</i>
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            The instruction <i>0x40100a <_start+10>:	movabs rsi,0x402000</i> simply moves the immediate value 0x402000 into the 64-bit register <i>rsi</i>.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_in_GDB_after_running_step3.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Exectuting the instruction <i>0x40100a <_start+10>:	movabs rsi,0x402000</i>
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                     <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            What is the significance of the value 0x402000?  It is actually a memory address.  We will examine the data at this memory address to see what it is, using the command:
                            <blockquote>
                                gdb-peda$ x/s 0x402000<br>
                                0x402000:	"Hello World to the SLAE-64 Course\n"<br>
                                gdb-peda$ <br>
                            </blockquote>
                        </p>
                        
                        <p>
                            So basically the contents of the array of addresses starting at 0x402000 contains the string "Hello World to the SLAE-64 Course\n".  We can see this more clearly by issuing the command:
                            <blockquote>
<pre>
    gdb-peda$ x/34xb 0x402000
    0x402000:	0x48	0x65	0x6c	0x6c	0x6f	0x20	0x57	0x6f
    0x402008:	0x72	0x6c	0x64	0x20	0x74	0x6f	0x20	0x74
    0x402010:	0x68	0x65	0x20	0x53	0x4c	0x41	0x45	0x2d
    0x402018:	0x36	0x34	0x20	0x43	0x6f	0x75	0x72	0x73
    0x402020:	0x65	0x0a
    gdb-peda$ 
</pre>
                            </blockquote>
                        </p>
                        
                        <p>
                            These are nothing but the hexadecimal representations of the bytes that make up the letters of the string "Hello World to the SLAE-64 Course\n".  Notice the 0x0a at the end, which is the newline character.  This is another bit of setup before the WRITE system call is invoked.  The WRITE system call will output the string located at 0x402000 to the screen. 
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                
                </div> <!-- .current_project_6 -->
            
            </section> <!-- section -->
            <!-- ************************************************************************************* Section End ************ -->
            
            <!-- ************************************************************************************* Section Start *********** -->
            <section class="section">
                
                <div class="current_project_7">
                
                    <hgroup>
                        <h2>
                            Running <i>helloworld</i> in GDB + GEF
                        </h2>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            Executing step <i>0x401014 <_start+20>      mov    edx, 0x22</i>
                        </p>
                        
                        <p>
                            Prior to executing the instruction <i>0x401014 <_start+20>      mov    edx, 0x22</i>>, the state of the registers and stack are as shown below:
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_in_GDB_before_running_step4.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Prior to executing the instruction <i>0x401014 <_start+20>      mov    edx, 0x22</i>>
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            The instruction <i>0x401014 <_start+20>      mov    edx, 0x22</i>> simply moves the immediate value 0x22 into the 32-bit register <i>edx</i>.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_in_GDB_after_running_step4.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                After executing the instruction <i>0x401014 <_start+20>      mov    edx, 0x22</i>>
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            The instruction <i>0x401014 <_start+20>      mov    edx, 0x22</i> moved the immediate value 0x22 into the 32-bit register <i>edx</i>.  The hex value 0x22 is 34 in decimal.  We will confirm this by using IPython for conversion and to get comfortable with incorporating more Python use for computing activities.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/using_ipython_to_convert_0x22_to_decimal.jpg"
                            width="640"
                            height="260"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Using IPython to convert hex 0x22 into decimal
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            0x22 hex or 34 decimal is the length of the string "Hello World to the SLAE-64 Course\n", including the newline character \n.  This was actually computed by the assembler and placed into the hardcoded opcodes.  If you recall, the original assembly code was:
                            <blockquote>
                            <!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>global _start

section <font color="#990000">.</font>text

_start<font color="#990000">:</font>

	<i><font color="#9A1900">; print on screen</font></i>
	<b><font color="#0000FF">mov</font></b> rax<font color="#990000">,</font> <font color="#993399">1
</font>
	<b><font color="#0000FF">mov</font></b> rdi<font color="#990000">,</font> <font color="#993399">1
</font>
	<b><font color="#0000FF">mov</font></b> rsi<font color="#990000">,</font> hello_world
	<b><font color="#0000FF">mov</font></b> rdx<font color="#990000">,</font> <b><font color="#0000FF
">length</font></b>
	syscall

	<i><font color="#9A1900">; exit gracefully</font></i>
	<b><font color="#0000FF">mov</font></b> rax<font color="#990000">,</font> <font color="#993399">60</font>
	<b><font color="#0000FF">mov</font></b> rdi<font color="#990000">,</font> <font color="#993399">11</font>
	syscall

section <font color="#990000">.</font>data
	hello_world<font color="#990000">:</font> <b><font color="#0000FF">db</font></b> <font color="#FF
0000">'Hello World to the SLAE-64 Course'</font><font color="#990000">,</font><font color="#993399">0x0a</font>
<b><font color="#000080">	length:</font></b> <b><font color="#0000FF">equ</font></b> $<font color="
#990000">-</font>hello_world
</tt></pre>

                            </blockquote>
                        </p>
                        
                        <p>
                            There was actually a trick used to obviate the need to manually count the number of characters in the string "Hello World to the SLAE-64 Course".  This trick was to create a constant called <i>length</i>, and to equate it to the memory location just after the string "Hello World to the SLAE-64 Course", subtracted from its memory location.  This memory location math gives exactly the length of the string "Hello World to the SLAE-64 Course".  The way to obtain the memory location of the constant is to use the "$" directive in the assembly code, as can be seen from the code snippet:
                            <blockquote>
                            <!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>
<b><font color="#000080">	length:</font></b> <b><font color="#0000FF">equ</font></b> <b>$</b><font color="
#990000">-</font>hello_world
</tt></pre>

                            </blockquote>
                        </p>
                        
                        <p>
                            This is the last bit of setup needed before invoking the WRITE system call.  The instruction <i>0x401014 <_start+20>      mov    edx, 0x22</i>, will let the WRITE system call know that the length of the string to output to the screen is 0x22 hex bytes long.  We are now ready to invoke the system call.  This will occur in the next instruction as shown in the next section.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                
                </div> <!-- .current_project_7 -->
            
            </section> <!-- section -->
            <!-- ************************************************************************************* Section End ************ -->
            
            <!-- ************************************************************************************* Section Start *********** -->
            <section class="section">
                
                <div class="current_project_8">
                
                    <hgroup>
                        <h2>
                            Running <i>helloworld</i> in GDB + PEDA
                        </h2>
                    </hgroup>
                    
                     <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            Executing the instruction <i>0x401019 <_start+25>:	syscall</i>
                        </p>
                        
                        <p>
                            Prior to executing the instruction
                            
                            <blockquote
                                <i>0x401019 <_start+25>:	syscall</i>
                            </blockquote>    
                            
                            the state of the registers and stack are as shown below:
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_in_GDB_before_running_step5.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Prior to executing the instruction <i>0x401019 <_start+25>:	syscall</i>
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            The <i>syscall</i> instruction invokes the Linux kernel to execute a system call.  In this case, we are invoking the WRITE system call, which will print the string "Hello World to the SLAE-64 Course" to the screen.  The results of this call are shown below.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_in_GDB_after_running_step5.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                After executing the instruction <i>0x401019 <_start+25>:	syscall</i>
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            It can be seen from the above screenshot that the WRITE system call was invoked properly as the string "Hello World to the SLAE-64 Course" was printed to the screen, and execution of the program is continuing normally.  The next step is to invoke the EXIT system call.  It is important to properly exit a program as the program counter may be pointing to an invalid instruction after the WRITE system call instructions.  In this case the program will crash.  Exiting properly will virtually guarantee that the program will exit gracefully back to the shell.  We will look at exiting gracefully in the next section.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                
                </div> <!-- .current_project_8 -->
            
            </section> <!-- third_section -->
            <!-- ************************************************************************************* Section End ************ -->
            
            <!-- ************************************************************************************* Section Start *********** -->
            <section class="section">
                
                <div class="current_project_9">
                
                    <hgroup>
                        <h2>
                            Running <i>helloworld</i> in GDB + PEDA
                        </h2>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            Executing the instruction 0x40101b <_start+27>:	mov    eax,0x3c
                        </p>
                        
                        <p> 
                            Prior to running the instruction
                            
                            <blockquote>
                                <i>0x40101b <_start+27>:	mov    eax,0x3c</i>
                            </blockquote>
                            
                            the state of the stack and registers are as shown in the following screenshot.
                        </p>
                        
                        <p>
                            As stated in the previous section, we must now have the program exit gracefully.  In order to do this, we setup an invocation to the EXIT system call.  This is done by loading eax with the system call number for the EXIT system call.  In this case, it is 0x3c hex, or 60 in decimal.  To find the correct system call number, we again look at the /usr/include/asm/unistd_64 and search for the EXIT system call.
                        </p>
                        
                        <p>
                            <blockquote>
                                <pre>
#define __NR_alarm 37
#define __NR_setitimer 38
#define __NR_getpid 39
#define __NR_sendfile 40
#define __NR_socket 41
#define __NR_connect 42
#define __NR_accept 43
#define __NR_sendto 44
#define __NR_recvfrom 45
#define __NR_sendmsg 46
#define __NR_recvmsg 47
#define __NR_shutdown 48
#define __NR_bind 49
#define __NR_listen 50
#define __NR_getsockname 51
#define __NR_getpeername 52
#define __NR_socketpair 53
#define __NR_setsockopt 54
#define __NR_getsockopt 55
#define __NR_clone 56
#define __NR_fork 57
#define __NR_vfork 58
#define __NR_execve 59
<big><b>#define __NR_exit 60</b></big>
#define __NR_wait4 61
#define __NR_kill 62
#define __NR_uname 63
#define __NR_semget 64
#define __NR_semop 65
#define __NR_semctl 66
#define __NR_shmdt 67
#define __NR_msgget 68
#define __NR_msgsnd 69
#define __NR_msgrcv 70
#define __NR_msgctl 71
#define __NR_fcntl 72
#define __NR_flock 73
#define __NR_fsync 74
#define __NR_fdatasync 75
#define __NR_truncate 76
                                
                                </pre>
                            </blockquote>
                        </p>
                        
                        <p>
                            From the above listing of the /usr/include/asm/unistd_64 file, we can see that indeed the EXIT system call number is 60, and this is the reason to load 60, or 0x3c hex into eax.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_in_GDB_before_running_step6.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Prior to executing the instruction 0x40101b <_start+27>:	mov    eax,0x3c
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_in_GDB_after_running_step6.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                After executing the instruction 0x40101b <_start+27>:	mov    eax,0x3c
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            It can be seen from the above screenshot that the the 0x3c hex or 60 decimal was loaded into eax.  This is the first part of setting up the EXIT system call.  The last part is to tell teh EXIT system call which return value to give back to the shell.  It is really an exit status, and is arbitrary.  Usually, when there are no errors, a zero is returned back to the shell.  In our case, we wish to return 0xb hex or 11 decimal as a learning tool.  We can then check the return exit status with an appropriate command.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                
                </div> <!-- .current_project_9 -->
            
            </section> <!-- third_section -->
            <!-- ************************************************************************************* Section End ************ -->
            
            <!-- ************************************************************************************* Section Start *********** -->
            <section class="section">
                
                <div class="current_project_10">
                
                    <hgroup>
                        <h2>
                            Running <i>helloworld</i> in GDB + PEDA
                        </h2>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            Executing the instruction 0x401020 <_start+32>:	mov    edi,0xb
                        </p>
                        
                        <p> 
                            Prior to executing the instruction:
                            <blockquote>
                                <i>0x401020 <_start+32>:	mov    edi,0xb</i>
                            </blockquote>
                            the state of the stack and registers are as shown in the following screenshot.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->

                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_in_GDB_before_running_step7.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Prior to executing instruction <i>0x401020 <_start+32>:	mov    edi,0xb</i>
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                     <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            The instruction:
                            <blockquote>
                                <i>0x401020 <_start+32>:	mov    edi,0xb</i>
                            </blockquote>
                            
                            simply moves the immediate value 0xb hex or 11 decimal into the 32-bit register edi.  This value is the return value of our executable to the calling shell.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_in_GDB_after_running_step7.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                After executing the instruction <i>0x401020 <_start+32>:	mov    edi,0xb</i>
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            After executing the instruction:
                            <blockquote>
                                <i>0x401020 <_start+32>:	mov    edi,0xb</i>
                            </blockquote>
                            
                            0xb hex or 11 decimal was loaded into the 32-bit register edi.  We are now ready to call the kernal to invoke the EXIT system call.  This is shown in the next section.
                            
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                
                </div> <!-- .current_project_10 -->
            
            </section> <!-- third_section -->
            <!-- ************************************************************************************* Section End ************ -->
            
            <!-- ************************************************************************************* Section Start *********** -->
            <section class="section">
                
                <div class="current_project_11">
                
                    <hgroup>
                        <h2>
                            Running <i>helloworld</i> in GDB + PEDA
                        </h2>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            Executing the instruction <i>0x401025 <_start+37>:	syscall</i>
                        </p>
                        
                        <p> 
                            Prior to executing the instruction:
                            <blockquote>
                                <i>0x401025 <_start+37>:	syscall</i>
                            </blockquote>
                            the state of the stack and registers are as shown in the following screenshot.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_in_GDB_before_running_step8.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Prior to executing the instruction <i>0x401025 <_start+37>:	syscall</i>
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                     <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p> 
                            After executing the instruction:
                            
                            <blockquote>
                                <i>0x401025 <_start+37>:	syscall</i>
                            </blockquote>
                            
                            the Linux kernel is called to invoke the EXIT system call with an exit status of 0xb or 11 decimal.
                            
                        </p>
                        
                        <p>
                            The results of executing this command are shown in the following screenshot.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/64bit_hello_world_in_GDB_after_running_step8.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                After executing the instruction <i>0x401025 <_start+37>:	syscall</i>
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p> 
                            We can see from the above screenshot that the process terminated with an exit code of 013.  Why is it not 0xb hex or 11 decimal?  Because apparently, GDB displays the exit code in octal.  As before, we will use Python to convert 013 octal into decimal.  This is shown in the following screenshot.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/using_ipython_to_convert_013_octal_to_decimal.jpg"
                            width="640"
                            height="320"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Using Python to convert 013 octal to decimal.
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p> 
                            We can also verify the exit status of the process by using the command:
                            <blockquote>
                                echo $?
                            </blockquote>
                        
                            This can be seen from the following screenshot.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                    <figure>
                        <div class="img">
                            <img 
                            src="../images/SLAE64/Module_1/005_Hello_world/cmd_line_exit_status.jpg"
                            width="1250"
                            height="900"
                            title=""
                            >
                        </div> <!-- .img -->
                        <div class="desc">
                            <p>
                                Using the Linux command line to obtain the exit status of a process.
                            <p>
                        </div> <!-- .desc -->
                    </figure>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            We can see from the above screenshot that the exit status of the terminated process is indeed 11.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                    
                </div> <!-- .current_project_11 -->
                
            </section> <!-- third_section -->
            <!-- ************************************************************************************* Section End ************ -->
            
            <!-- ************************************************************************************* Section Start *********** -->
            <section class="section">
                
                <div class="current_project_12">
                
                    <hgroup>
                        <h2>
                            Conclusions on examining <i>helloworld</i> in GDB.
                        </h2>
                    </hgroup>
                    
                    <!-- ********************************************************************* Loose Text -->                
                    <div class="loose_text">
                        
                        <p>
                            In this section we looked at examining the execution of a simple 64 bit binary in GDB.  We looked at how system calls are setup and how they are invoked.  We also looked at how to obtain the exit status of a terminated process.  In the next section, we will examine why the <i>helloworld</i> executable is not suitable for being used as shellcode.  The reasons are that:
                            <ul>
                                <li>
                                    The object code for the executable contains many nulls.  This is evident by examining the object file's dump:
                                    <pre>
    $objdump -d helloworld.o 

        helloworld.o:     file format elf64-x86-64


        Disassembly of section .text:

        0000000000000000 <_start>:
        0:	48 b8 01 00 00 00 00 	movabs $0x1,%rax
        7:	00 00 00 
        a:	48 bf 01 00 00 00 00 	movabs $0x1,%rdi
        11:	00 00 00 
        14:	48 be 00 00 00 00 00 	movabs $0x0,%rsi
        1b:	00 00 00 
        1e:	48 ba 22 00 00 00 00 	movabs $0x22,%rdx
        25:	00 00 00 
        28:	0f 05                	syscall 
        2a:	48 b8 3c 00 00 00 00 	movabs $0x3c,%rax
        31:	00 00 00 
        34:	48 bf 0b 00 00 00 00 	movabs $0xb,%rdi
        3b:	00 00 00 
        3e:	0f 05                	syscall 

    $
                                    </pre>
                                    
                                    <p>
                                        We can see from the objdump above that the code indeed includes many nulls.  These nulls make the code above unsuitable for shellcode.
                                    </p>
                                    
                                </li>
                                
                                <li>    
                                    The code makes use of the full 64-bit registers, which can hold very large numbers; however, the immediate numbers that we have used are relatively very small, less than then integer 100.  This is an inefficient use of resources.  In shellcoding, we want to make the shellcode as efficient and compact as possible.
                                </li>
                            </ul>
                        </p>
                        
                        <p>
                            In the next section, we will look at how to remove these nulls and optimize the code so that it can be suitable to be used as shellcode.
                        </p>
                        
                    </div> <!-- .loose_text -->
                    <!-- ********************************************************************* Loose Text -->
                
                </div> <!-- .current_project_12 -->
            
            </section> <!-- third_section -->
            <!-- ************************************************************************************* Section End ************ -->
            
        </section>	<!-- .content -->
    
    <div> <!-- .wrapper -->

  </body>

</html>
