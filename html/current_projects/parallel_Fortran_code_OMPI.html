<!DOCTYPE html>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58919029-1', 'auto');
  ga('send', 'pageview');

</script>

<html>

<head>
  <meta content="text/html; charset=utf-8" http-equiv="content-type">
  <meta name="robots" content="follow" />
  
  <title>
    MK Dynamics - Programming - Programming in FORTRAN
  </title>
  
  <link href="../css/styles.css" type = "text/css" rel = "stylesheet" />
  
  <style>
    .content {
	overflow: auto;
	height: 80%; 
	background: url("../images/galaxy1.jpg") no-repeat center center fixed;
	background-size: cover;
	background-position: center;
	padding: 10px;
	margin: 10px;
	border: 5px solid black;
      }
      
    h1, h2, h3, h4 {
      color: white;
      display: block;     
    }
    
    .current_project_1 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1250px;
      height		: 1050px;
      top		: 0px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding-left	: 10px;
    }
    
    .current_project_2 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1250px;
      height		: 300px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding-left	: 10px;
    }
    
    .current_project_3 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1250px;
      height		: 4300px;
      top		: 000px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding-left	: 10px;
    }
    
    .current_project_4 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1250px;
      height		: 2200px;
      top		: 10px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_5 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1250px;
      height		: 7400px;
      top		: 10px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    .current_project_6 {
      border		: 5px solid black;
      background	: gray;
      position		: relative;
      width		: 1250px;
      height		: 8000px;
      top		: 10px;
      left		: 0px;
      float		: left;
      margin		: 10px;
      padding		: 10px;
    }
    
    div .img {
      margin		: 0px;
      padding		: 10px;
      height		: auto;
      width		: auto;
      float		: left;
    }
    
    div .img img {
      display		: block;
      margin		: 0px;
      padding		: 0px;
    }
    
    div .desc {
      color		: white;
      width		: 600px;
      margin		: 5px;
      padding		: 10px;
    }
    
    ul {
      color		: white;
    }
    
    div .loose_text {
      color		: white;
      text-align        : justify;
      display           : block;
    }
    
  </style>
</head>

<body>
  <div class="wrapper">
    <header>
    
      <hgroup>
	<h1> 
	    <big> <big> MK Dynamics </big> </big>
	</h1>


	<h2>
	  Programming - Parallel Fortran Code
	</h2>
      </hgroup>
    

      <nav>
	<ul>
	  <li> <a href="../index.html">Home</a> </li>
	  <li> <a href="rpi3_supercomputer.html">Back</a></li>
	</ul>
      </nav>
  
      <hr />
    
    </header>
    
  

    <section class="content">
    
        <section class="second_section">
        
            <div class="current_project_2">
            
                <hgroup>
                    <h2>
                        Description
                    </h2>
                    
                    <h3>
                        Introduction
                    </h3>
                </hgroup>

                <div class="loose_text">
                    <p>
                        The Open MPI project is an open source implementation of the Message Passing Interface.  The interface is a suite of tools that allow for interprocess communications which facilitate executing portions of a program in parallel.  Detailed discussions on the the Message Passing Interface (MPI) can be found here: <br>
                        <a href="http://condor.cc.ku.edu/~grobe/docs/intro-MPI.shtml">http://condor.cc.ku.edu/~grobe/docs/intro-MPI.shtml</a><br>
                        <br>
                        Details on OpenMPI can be found here:<br>
                        <a href="https://www.open-mpi.org">https://www.open-mpi.org</a><br>
                    </p>
                </div> <!-- .loose-text -->
	

            </div> <!-- .current_project_2 -->
            
        </section> <!-- second_section --> 
    

        <section class="third_section">
    
            <div class="current_project_3">
                <hgroup>
                    <h2>
                        Installing OpenMPI as a plugin to the Eclips IDE + Photran + Parallel Tools Platform Framework
                    </h2>
                </hgroup>
                
                <div class="loose_text">
                    <p>
                        We start by installing OpenMPI, which can be downloaded here:<br>
                        <a href="https://www.open-mpi.org/software/ompi/v1.8">https://www.open-mpi.org/software/ompi/v1.8</a><br>
                        <br>
                        At the time of this writing, version 2.0.0 is NOT supported by our IDE, called Eclipse NEON.  Rather, version 1.8.8 needs to be downloaded and installed.  Our targer system is an Intel quad-core I7 processor, running Fedora 23 Linux (64 bit version).  This detail will become important as we delve deeper into the actual mechanisms of execution.  This type of processor should be general enough for most cases.
                    </p>
                    
                    <p>
                        Once the tarball has been decompressed, it is important to adjust the LD_LIBRARY_PATH environment variable to point to the proper location, otherwise, there will be much grief during linking and running the generated executables.  This variable must be properly set prior to installing OpenMPI because directories are actually hardcoded into installation at build time.  In my system, I found the following to work properly:<br>
                        <br>
                    </p>
                </div> <!-- .loose_text -->
                
                <div class="img">
                    <img
                        src="images/LD_LIBRARY_PATH.jpeg"
                        width="1200px"
                        height="600px"
                        title="LD_LIBRARY_PATH.jpeg"
                    >
                </div> <!-- .img -->
            
                <div class="loose_text">
                    <p>
                        Then from the install directory that contains the decompressed installation files, it is required to do a ./configure --with-devel-headers.  The --with-devel-headers switch will install additional files required by the Eclipse IDE to properly work with the OpenMPI modules.<br>
                    </p>
                </div> <!-- .loose_text -->

                <div class="img">
                    <img
                        src="images/dot_slash_configure.jpeg"
                        width="1200px"
                        height="600px"
                        title="dot_slash_configure.jpeg"
                    >
                </div> <!-- .img -->
                
                <div class="loose_text">
                    <p>
                        The configuration script will perform a series of systems tests and setup the make files for a system specific build.  Generally, the configuration takes a few minutes and completes with no issues.  Once the configuration is complete, we are now ready to perfom the install, which will build the system specific executables and libraries.<br>  This can be accomplished by entering: sudo make -j 4 install all<br>
                    </p>
                </div> <!-- .loose_text -->
                
                <div class="img">
                    <img
                        src="images/make_install_all.jpeg"
                        width="1200px"
                        height="600px"
                        title="make_install_all.jpeg"
                    >
                </div> <!-- .img -->
                
                <div class="loose_text">
                    <p>
                        The sudo is required because the libraries and executables need to be installed as root.  The -j 4 switch causes make to use all four cores to person the build, greatly speeding up the process.  It takes a about 5 minutes on this Intel I7 3GHz processor.<br>
                    </p>
                    
                    <p>
                        Once the installation has completed, it's status can be viewed by typing ompi_info at the command prompt.<br>
                    </p>
                </div> <!-- .loose_text -->
                
                <div class="img">
                    <img
                        src="images/ompi_info.jpeg"
                        width="1200px"
                        height="600px"
                        title="ompi_info.jpeg"
                    >
                </div> <!-- .img -->
                
                <div class="loose_text">
                    <p>
                        A full listing of the output of ompi_info is shown below:
                    </p>
                </div> <!-- .loose_text -->
                
                <iframe
                        src = "Fortran_OMPI/ompi_info.txt"
                        width = "1200"
                        height = "800"
                        frameborder = "1"
                        scrolling = "yes">
                </iframe>
                
                <div class="loose_text">
                    <p>
                        Notice that the version of Open MPI is 1.8.8.  At the time of this writing, this version is known to work with the Eclipse IDE + Photran + Parallel Tools Platform.  In the author's understanding, version 2.0.0 is known to NOT work.
                    </p>
                    
                    <p>
                        It was found that if, after compilation and exectution of source code, that error messages are displayed pertaining to MPI or MCA, a working remedy is to ensure that the LD_LIBRARY_PATH environment variable is properly set, and then to reconfigure and rebuild the OpenMPI installation files as described above.  If problems persist, another thing to try is to rename the folder /usr/local/lib/openmpi to /usr/local/lib/openmpi_backup, and then perform a ./configure --with-devel-headers and then a sudo make -j 4 install all.  This will ensure that fresh files are installed into /usr/local/lib/openmpi.
                    </p>
                    
                    <p>
                        More information on installation issues can be found here:<br>
                        <a href="https://eclipse.org/ptp/docs/releases/release-1.1.php">https://eclipse.org/ptp/docs/releases/release-1.1.php</a><br>
                        <a href="https://www.open-mpi.org/faq/?category=building#easy-build">https://www.open-mpi.org/faq/?category=building#easy-build</a><br>
                    </p>
                </div> <!-- .loose_text -->
                
            </div> <!-- .current_project_3 -->
        
        </section> <!-- .third_section -->

<!--***************************************************************************************************** -->        
        
        <section class="fourth_section">
    
            <div class="current_project_4">
                <hgroup>
                
                    <h2>
                        Installing the Eclipse IDE + Photran + Parallel Tools Platform
                    </h2>
                    
                </hgroup>
                
                <div class="loose_text">
                    <p>
                        At the time of this writing, the latest version of the Eclipse Integrated Development Environment (IDE) is NEON.<br>
                        It can be downloaded here:<br>
                        <a href="https://www.eclipse.org/downloads/download.php?file=/technology/epp/downloads/release/neon/R/eclipse-parallel-neon-R-linux-gtk-x86_64.tar.gz">https://www.eclipse.org/downloads/download.php?file=/technology/epp/downloads/release/neon/R/eclipse-parallel-neon-R-linux-gtk-x86_64.tar.gz</a><br>
                        Other tools are also available for the Eclipse Platform and may be ontained by following the links on their homepage.
                    </p>
                    
                    <p>
                        I recommend decomressing the downloaded Eclipse installation files into a temporary directory, such as /home/Installs/eclipse-installer
                    </p>
                </div> <!-- .loose_text -->
                
                <div class="img">
                    <img 
                        src="images/eclipse_installer1.jpeg"
                        width="1200"
                        height="800"
                        title="eclipse_installer1.jpeg"
                    >
                </div> <!-- .img -->
            
                <div class="loose_text">
                    <p>
                    
                    </p>
                </div> <!-- .loose_text -->
                
                <div class="loose_text">
                    <p>
                        To install, simply run the file eclipe_inst by entering ./eclipse_inst at the command prompt.  Eclipse requires Java to run; therefore, if there are any installation issues, it is recommended that you ensure that the latest version of Java is installed on your machine.
                    </p>
                    
                    <p>
                        After Eclipse is installed, click "Launch" to start it up.  It "may" be necessary to install some additional add-on tools to access the parallel development tools.  I can't be certain since I have tried installation a number of times before I was able to get the system to operate properly.  This is more a reflection of my learning curve and my particular system setup, and not a criticism per se of the Eclipse developers.
                    </p>
                    
                    <p>
                        Once the Eclipse IDE is up and running, go to >help>Install New Software, which will bring up the following screen:
                    </p>
                </div> <!-- .loose_text -->
                
                <div class="img">
                    <img 
                        src="images/eclipse_updates.jpeg"
                        width="1200"
                        height="800"
                        title="eclipse_updates.jpeg"
                    >
                </div> <!-- .img -->
                
                <div class="loose_text">
                    <p>
                        Ensure that all "Linux Tools", "Parallel Tools Platform", and "Performance, Profiling and Tracing Tools" are selected, and click "Next" to update the Eclipse IDE.
                    </p>
                </div> <!-- .loose_text -->
                

            </div> <!-- .current_project_4 -->
            
        </section> <!-- .fourth_section -->

<!-- ********************************************************************************************************* -->
    
        <section class="fifth_section">
        
            <div class="current_project_5">
                
                <hgroup>
                
                    <h2>
                        Setting Up The Eclipse IDE For Compiling A Simple Hello World Type Program With Parallel Execution
                    </h2>
                    
                </hgroup>
                
                <div class="loose_text">
                    <p>
                        Now that the OpenMPI binaries are installed, a new project can be started within the Eclipse IDE.  Since I am using GNU+Linux, and wish to use GNU as much as possible, I will use the GNU Fortran compiler, versus the Intel Fortran Compiler.  This is a personal preference.  The discussions that follow will assume use of the GNU Fortran compiler.
                    </p>
                    
                    <p>
                        To start a new project, go to >File>New Project> and drill down to "Others" in "Project type:".  Select Executable (Gnu Fortran on Linux/*nix).  The "Toolchains:" should have GCC Fortran highlighted.
                    </p>
                    
                </div> <!-- .loose_text -->
                    
                <div class="img">
                    <img 
                        src="images/new_fortran_project.jpeg"
                        width="1200"
                        height="800"
                        title="new_fortran_project.jpeg"
                    >
                </div> <!-- .img -->
                
                
                <div class="loose_text">
                    <p>
                        It is a good idea to have "use default location" and "show project types and toolchains only if they are supported on the platform" checkmarked, to minimize having to go in to the configurations and be forced to mess around with paths and directory settings.  Give the project a meaningful name and click "Next".
                    </p>
                    
                    <p>
                        Under "Configurations:", ensure that Debug and Release are checked.  This is more a check to verify that the toolchain is working properly.  It is also useful to have two versions of a project once it becomes sufficiently complex.  If all is well click "Advanced Settings".
                    </p>
                </div> <!-- .loose_text -->
                
                <div class="img">
                    <img 
                        src="images/select_configurations.jpeg"
                        width="1200"
                        height="800"
                        title="select_configurations.jpeg"
                    >
                </div> <!-- .img -->
                
                <div class="loose_text">
                    <p>
                        The next step gave me allot of grief until I figured it out, and I am happy to be able to save you some trouble...  Since we are going to be using OpenMPI, it states on the OpenMPI website that it is HIGHLY recommended to use their specialized compiler and execution binaries.  We must tell the Eclipse IDE to use "mpifort" rather than "gfortran" to compile and link.  "mpifort" has special wrappers embedded that handle accessing all of the required includes and libraries.  Without this, setting up all of paths and environment variables can be a daunting task.  "mpifort" makes it a snap to compile OpenMPI based programs.
                    </p>
                    
                    <p>
                        To set this up, under "Advanced Settings", go to "Fortran Build" and select the drop-down arrow.  Select "Settings" and then GNU Fortran Compiler.  In the box that says "gfortran", replace it with "mpifort".
                    </p>
                </div> <!-- .loose_text -->

                <div class="img">
                    <img 
                        src="images/setup_mpifort_as_compiler.jpeg"
                        width="1200"
                        height="800"
                        title="setup_mpifort_as_compiler.jpeg"
                    >
                </div> <!-- .img -->
                
                <div class="loose_text">
                    <p>
                        Once "mpifort" is used as the compiler, you don't have to worry about setting up the includes or libraries.  The next step is not critically necessary but I like to have verbose messages when compiling, so I went ahead and set the "Debug Level" to "Maximum" and checked "Generate gprof information (-pg)" and "Generate prof information (-p)" under "Debugging".  Under "Miscellaneous" I checkmarked "Verbose (-v)".
                    </p>
                    
                    <p>
                       Once the compiler is setup, the linker is next.  Basically, the exact same things are done for the linker.  Click "GNU Fortran Linker" and change the "command" from gfortran to "mpifort".
                    </p>
                    
                </div> <!-- .loose_text -->

                <div class="img">
                    <img 
                        src="images/setup_mpifort_as_linker.jpeg"
                        width="1200"
                        height="800"
                        title="setup_mpifort_as_linker.jpeg"
                    >
                </div> <!-- .img -->
                
                <div class="loose_text">
                    <p>
                        As before, it is not critically necessary but you can go to the "Debugging" item and checkmark the production of additional debugging information.  Once the command is changed to "mpifort", click "OK" and then "Finish".  You should now be in the Eclipse IDE Photran screen.  This is perspective that allows for actually entering, building and running the code.  I have been messing around with Photran for a while, so details on your screen will be slightly different.
                    </p>
                </div> <!-- .loose_text -->
                
                <div class="img">
                    <img 
                        src="images/photran_start_screen.jpeg"
                        width="1200"
                        height="800"
                        title="photran_start_screen.jpeg"
                    >
                </div> <!-- .img -->
                
                <div class="loose_text">
                    <p>
                        Right click on the name of your newly created project in the "Project Explorer" and select "New" and then "Fortran Source Code".
                    </p>
                </div> <!-- .loose_text -->
                
                <div class="img">
                    <img 
                        src="images/photran_new_fortran_source_file.jpeg"
                        width="1200"
                        height="800"
                        title="photran_new_fortran_source_file.jpeg"
                    >
                </div> <!-- .img -->
                
                <div class="loose_text">
                    <p>
                        Give the new source file a meaningful name, MAKING SURE TO GIVE THE FILENAME A .f08 EXTENSION. The extension must be a .f08, with a non-capital "f".  Keep "Template" set to "Default free-form Fortran source file template".  Verify and click "Finish".
                    </p>
                </div> <!-- .loose_text -->
                
                <div class="img">
                    <img 
                        src="images/photran_new_fortran_source_file_name.jpeg"
                        width="600px"
                        height="400px"
                        title="photran_new_fortran_source_file_name.jpeg"
                    >
                    
                    <div class="loose_text">
                        <p>
                            I don't recommend changing the source folder because it may become difficult to build the project due to PATH issues.  Click "Finish" when done.  A new file will appear in the "Project Explorer" with the name given.  Double click this file and the editing screen will appear.  A default tempplate program will appear, but we will not be using it.  Go ahead and delete all of the lines in the editor.  As a first program, I found the one named "Hello World" at:<br>
                            <a href="http://condor.cc.ku.edu/~grobe/docs/intro-MPI.shtml">http://condor.cc.ku.edu/~grobe/docs/intro-MPI.shtml</a><br>
                            to be useful.  Copy and paste it into the editor.
                        </p>
                    </div> <!-- .loose_text -->
                    
                </div> <!-- .img -->
                    
                <div class="img">
                    <img 
                        src="images/hello_world_in_photran.jpeg"
                        width="1200"
                        height="800"
                        title="hello_world_in_photran.jpeg"
                    >
                </div> <!-- .img -->
                
                <div class="loose_text">
                    <p>
                        We are now ready to compile, link and execute the "Hello World" type program to verify that all is setup correctly.  In a subsequent section, we will using the debug functions of the Eclipse IDE to step through the disassembly of the executable to gain valuable insights into the physical implementation of parallel exectution code.
                    </p>
                </div> <!-- .loose_text -->
                    
            </div> <!-- .current_project_5 -->
      
        </section> <!-- .fifth_section -->
        
<!-- ********************************************************************************************************* -->

        <section class="sixth_section">
        
            <div class="current_project_6">
            
                <hgroup>
                
                    <h2>
                        Compiling, Linking and Executing A Simple Hello World Type Program With Parallel Execution
                    </h2>
                    
                </hgroup>
                
                <div class="loose_text">
                    <p>
                        Assuming everything was setup as described in the previous sections, to compile the program should be as simple as clicking on >Project>Build Project.  There will be some activity with a progress bar, and allot of verbose debugging information will appear in the console as shown below:
                    </p>
                </div> <!-- .loose_text -->
                
                <div class="img">
                    <img 
                        src="images/hello_world_compile_in_photran.jpeg"
                        width="1200"
                        height="800"
                        title="hello_world_compile_in_photran.jpeg"
                    >
                </div> <!-- .img -->
                
                <div class="loose_text">
                    <p>
                        I am an information junkie, and looking at the verbose debugging output on the console is very pleasing.  Of important note is that underneath the line which says "Invoking: GNU Fortran Compiler", there is a command line that starts with "mpifort", and under "Invoking: GNU Fortran Linker", there is another line which starts with "mpifort".  As explained in the previous sections, "mpifort" is a special wrapper executable which enabled greatly facilitated compilation and linking of Fortran programs using MPI, without having to worry about PATHs or setting up libraries.
                    </p>
                    
                    <p>
                        As can be seen at the bottom of the console output, the program compiled and linked properly, with no error messages.  We are now ready to run the program.  First we will run the program using a single core and single thread to make sure everything works so far.  Then we will step up to multiple cores/threads.  To run a program, a "Run Configuration" needs to be created first.
                    </p>
                </div> <!-- .loose_text -->
                
                
                

            </div> <!-- .current_project_6 -->
      
        </section> <!-- .sixth_section -->
        
<!-- ********************************************************************************************************* -->
    
     </section>	<!-- .content -->
    
  </div> <!-- .wrapper -->

  </body>

</html>
  

